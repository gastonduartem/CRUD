<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title><%= title %></title>
  <link rel="stylesheet" href="/css/styles.css">
</head>
<body>
  <div class="container">
    <!-- ==================== HEADER ==================== -->
    <header class="header">
      <div class="title">
        <span class="logo">üóÇÔ∏è</span>
        <h1>Topics</h1>
      </div>
      <!-- Bot√≥n para crear un nuevo topic -->
      <a class="btn btn--primary" href="/topics/new">+ Nuevo</a>
    </header>

    <!-- ==================== MENSAJE SI NO HAY TOPICS ==================== -->
    <% if (!topics || topics.length === 0) { %>
      <div class="card card--empty">
        <h2 class="muted">A√∫n no hay topics</h2>
        <p>Crea tu primer topic para empezar a votar y ordenar.</p>
        <a class="btn btn--primary" href="/topics/new">Crear topic</a>
      </div>
    <% } else { %>

      <!-- ==================== TABLA DE TOPICS ==================== -->
      <div class="card">
        <div class="table-top">
          <!-- Info de orden -->
          <div class="muted">Ordenado por votos (desc)</div>
          <!-- Bot√≥n refrescar -->
          <a class="btn btn--neutral" href="/">‚Üª Actualizar</a>
        </div>
        <div class="table-wrap">
          <table class="table">
            <thead>
              <tr>
                <!-- Distribuci√≥n de anchos de columnas -->
                <th style="width:28%">T√≠tulo</th>
                <th style="width:36%">Descripci√≥n</th>
                <th style="width:10%">Votos</th>
                <th style="width:12%">Creado</th>
                <th style="width:14%" class="txt-right">Acciones</th>
              </tr>
            </thead>
            <tbody>
              <% topics.forEach(t => { %>
                <tr>
                  <!-- ==================== COLUMNA: T√çTULO ==================== -->
                  <td class="title-cell">
                    <strong><%= t.title %></strong>
                    <!-- Badge para marcar "Popular" si tiene 10 o m√°s votos -->
                    <% if (t.votes >= 10) { %>
                      <span class="badge">Popular</span>
                    <% } %>
                  </td>

                  <!-- ==================== COLUMNA: DESCRIPCI√ìN ==================== -->
                  <td class="muted"><%= t.description || '‚Äî' %></td>

                  <!-- ==================== COLUMNA: VOTOS ==================== -->
                  <td><span class="kpi"><%= t.votes %></span></td>

                  <!-- ==================== COLUMNA: FECHA DE CREACI√ìN ==================== -->
                  <td class="muted"><%= t.created_at %></td>

                  <!-- ==================== COLUMNA: ACCIONES ==================== -->
                  <td class="txt-right">
                    <div class="actions">
                      <!-- üîó Enlace externo (si existe un link en la DB) -->
                      <% if (t.link && t.link.trim()) { %>
                        <a
                          class="btn btn--neutral"
                          href="<%= t.link %>"
                          target="_blank"
                          rel="noopener noreferrer"
                          title="Abrir enlace externo"
                        >üîó</a>
                      <% } else { %>
                        <!-- Bot√≥n deshabilitado si no hay link -->
                        <button class="btn btn--neutral" disabled title="Sin enlace">üîó</button>
                      <% } %>

                      <!-- Bot√≥n: votar positivo -->
                      <form method="post" action="/topics/<%= t.id %>/vote?dir=up">
                        <button class="btn btn--icon" title="Votar positivo">üëç</button>
                      </form>

                      <!-- Bot√≥n: votar negativo -->
                      <form method="post" action="/topics/<%= t.id %>/vote?dir=down">
                        <button class="btn btn--icon" title="Votar negativo">üëé</button>
                      </form>

                      <!-- Bot√≥n: editar -->
                      <a class="btn btn--neutral" href="/topics/<%= t.id %>/edit" title="Editar">‚úèÔ∏è</a>

                      <!-- Bot√≥n: eliminar (con confirmaci√≥n) -->
                      <form method="post" action="/topics/<%= t.id %>/delete" onsubmit="return confirm('¬øEliminar este topic?')">
                        <button class="btn btn--danger" title="Eliminar">üóëÔ∏è</button>
                      </form>
                    </div>
                  </td>
                </tr>
              <% }) %>
            </tbody>
          </table>
        </div>
      </div>
    <% } %>

    <!-- ==================== FOOTER ==================== -->
    <footer class="footer">
      <span class="muted">CRUD Challenge ‚Ä¢ Express + EJS + SQLite</span>
    </footer>
  </div>
</body>
</html>
